<h2 mat-dialog-title>
    {{ modalData.mode === "add" ? "Add " : "Update" }}
    Transaction
</h2>
<form
    [formGroup]="form"
    (ngSubmit)="submitForm()"
>
    <mat-dialog-content class="content">
        <mat-form-field>
            <mat-label> Amount </mat-label>
            <input
                matInput
                type="text"
                formControlName="amount"
                (keydown)="checkIfValidKey($event)"
                (input)="addValue($event)"
                [value]="form.value.amount | currency"
            />
            <mat-error>
                {{
                    form.get("amount")?.hasError("required") &&
                    form.get("amount")?.touched
                        ? "Amount is required"
                        : form.get("amount")?.hasError("min") &&
                            form.get("amount")?.touched
                          ? "Amount must be more than 0"
                          : ""
                }}
            </mat-error>
        </mat-form-field>
        <div class="inner-fields-wrapper">
            <mat-form-field class="fullwidth">
                <mat-label> Choose a date </mat-label>
                <input
                    matInput
                    [matDatepicker]="picker"
                    formControlName="date"
                    (dateChange)="getCategories($event)"
                    [max]="today"
                />
                <mat-hint> MM/DD/YYYY </mat-hint>
                <mat-datepicker-toggle
                    matIconSuffix
                    [for]="picker"
                />
                <mat-datepicker #picker />
                <mat-error>
                    {{
                        form.get("date")?.errors && form.get("date")?.touched
                            ? "Date is required"
                            : ""
                    }}
                </mat-error>
            </mat-form-field>
            <mat-form-field class="fullwidth">
                <mat-label> Merchant </mat-label>
                <input
                    matInput
                    formControlName="merchant"
                />
                <mat-error>
                    {{
                        form.get("merchant")?.errors &&
                        form.get("merchant")?.touched
                            ? "Merchant is required"
                            : ""
                    }}
                </mat-error>
            </mat-form-field>
        </div>
        <mat-form-field
            [matTooltip]="
                !dropdownCategories().length
                    ? 'Please pick a date to show budget items'
                    : ''
            "
        >
            <mat-label> Select Budget Item </mat-label>
            <mat-select formControlName="lineItem">
                @if (dropdownCategories().length) {
                    @for (
                        category of dropdownCategories();
                        track category.budgetCategoryId
                    ) {
                        <mat-optgroup
                            [label]="category.budgetCategoryName"
                            style="font-weight: bold"
                        >
                            @for (
                                lineItem of category.lineItems;
                                track lineItem.lineItemId
                            ) {
                                <mat-option [value]="lineItem">
                                    {{ lineItem.lineItemName }}
                                </mat-option>
                            }
                        </mat-optgroup>
                    }
                }
            </mat-select>
            <mat-error>
                {{
                    form.get("lineItem")?.errors &&
                    form.get("lineItem")?.touched
                        ? "Budget item is required"
                        : ""
                }}
            </mat-error>
        </mat-form-field>
        <mat-form-field class="fullwidth">
            <mat-label> Notes </mat-label>
            <textarea
                matInput
                formControlName="notes"
                cdkTextareaAutosize
                #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="5"
                cdkAutosizeMaxRows="10"
            ></textarea>
        </mat-form-field>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button
            mat-flat-button
            type="button"
            (click)="closeModal()"
        >
            cancel
        </button>
        <button
            mat-flat-button
            color="primary"
            style="color: white"
            type="submit"
            [disabled]="!(form.valid && form.dirty)"
        >
            {{ modalData.mode === "add" ? "Add" : "Update" }}
        </button>
    </mat-dialog-actions>
</form>
